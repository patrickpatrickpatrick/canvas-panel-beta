/*
 *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
*****************************************************************************/
'use strict';!function(g,l){"object"==typeof exports&&"undefined"!=typeof module?l(exports,require("react"),require("manifesto.js")):"function"==typeof define&&define.amd?define(["exports","react","manifesto.js"],l):l((g=g||self).CanvasPanelBeta={},g.react,g.Manifesto)}(this,function(g,l,z){function M(a,c){function b(){this.constructor=a}P(a,c);a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}function u(a,c){var b={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>c.indexOf(d)&&
(b[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>c.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(b[d[e]]=a[d[e]])}return b}function aa(a,c){function b(b){return function(h){return function(b){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,e&&(f=2&b[0]?e.return:b[0]?e.throw||((f=e.return)&&f.call(e),0):e.next)&&!(f=f.call(e,b[1])).done)return f;switch(e=0,f&&
(b=[2&b[0],f.value]),b[0]){case 0:case 1:f=b;break;case 4:return m.label++,{value:b[1],done:!1};case 5:m.label++;e=b[1];b=[0];continue;case 7:b=m.ops.pop();m.trys.pop();continue;default:if(!(f=m.trys,(f=0<f.length&&f[f.length-1])||6!==b[0]&&2!==b[0])){m=0;continue}if(3===b[0]&&(!f||b[1]>f[0]&&b[1]<f[3]))m.label=b[1];else if(6===b[0]&&m.label<f[1])m.label=f[1],f=b;else if(f&&m.label<f[2])m.label=f[2],m.ops.push(b);else{f[2]&&m.ops.pop();m.trys.pop();continue}}b=c.call(a,m)}catch(A){b=[6,A],e=0}finally{d=
f=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([b,h])}}var d,e,f,h,m={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return h={next:b(0),throw:b(1),return:b(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h}function r(a,c){var b="function"==typeof Symbol&&a[Symbol.iterator];if(!b)return a;var d;a=b.call(a);var e=[];try{for(;(void 0===c||0<c--)&&!(d=a.next()).done;)e.push(d.value)}catch(h){var f={error:h}}finally{try{d&&!d.done&&
(b=a.return)&&b.call(a)}finally{if(f)throw f.error;}}return e}function C(a){var c=l.createContext(a);return[function(){var a=l.useContext(c);if(!a)throw Error("useCtx must be inside a Provider with a value");return a},c.Provider]}function Q(a,c){return z.parseManifest(a,c)}function w(a,c){return a&&(b=a)&&"[object Function]"==={}.toString.call(b)?a(c)||k.createElement("div",null,"Could not render children from function"):k.Children.map(a,function(a){return k.cloneElement(a,c)})||k.createElement("div",
null,"Could not clone children");var b}function D(a){var c=ba();return l.useMemo(function(){var b=Object.assign({},R,c);b=b.cssClassMap[a]?S.block(""+b.prefix+b.cssClassMap[a]):S.block(""+b.prefix+a);return b},[c,a])}function ca(a){return c=this,b=void 0,e=function(){var b,c,d;return aa(this,function(e){return(b=a.getProperty("annotations"))?(c=Array.isArray(b)?b:[b],d=c.map(function(b,c){return new da(b.label||"Annotation list "+c,b,a.options)}),[2,Promise.all(d)]):[2,Promise.resolve([])]})},new (d=
void 0,d=Promise)(function(a,h){function f(a){try{p(e.next(a))}catch(A){h(A)}}function B(a){try{p(e.throw(a))}catch(A){h(A)}}function p(b){b.done?a(b.value):(new d(function(a){a(b.value)})).then(f,B)}p((e=e.apply(c,b||[])).next())});var c,b,d,e}function T(){var a=x().canvas,c=r(l.useState([]),2),b=c[0],d=c[1];c=r(l.useState([]),2);var e=c[0],f=c[1];return l.useEffect(function(){a&&(d([]),ca(a).then(function(b){0===b.length?(f([]),a.getOtherContent().then(function(a){f(a)}).catch(function(a){console.log("Could not find annotations.");
console.log(a)})):d(b)}))},[a]),[l.useMemo(function(){return function(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(r(arguments[b]));return a}(e,b)},[b,e]),{embeddedAnnotationLists:b,externalAnnotationLists:e}]}function E(a,c){if(void 0===c&&(c=1),!a)return a;var b=/[#&?](xywh=)?(pixel:|percent:)?([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?)/.exec(a);return b?{unit:"percent:"===b[2]?"percent":"pixel",scale:c,expanded:!0,x:parseFloat(b[3])*c,y:parseFloat(b[4])*
c,width:parseFloat(b[5])*c,height:parseFloat(b[6])*c,toString:function(){return a.split("#")[0]}}:a}function ea(a){var c=function(a){return a.getContent().filter(function(a){a=a.getBody();return!!a.length&&a.reduce(function(a,b){return a||b.getIIIFResourceType().toString()===N.IMAGE.toString()},!1)})}(a);return c.length&&c[0]&&(c=c[0].getBody().reduce(function(a,c){return a||c.getServices().reduce(function(a,b){return a||(z.Utils.isImageProfile(b.getProfile())||"level1"===b.getProfile()||"level2"===
b.getProfile()?b:null)},a)},null))?c.getInfoUri():(c=a.getImages())&&c.length?function(a){var b=null,c=a[0].getResource();a=c.getServices();if(a.length){for(c=0;c<a.length;c++){var f=a[c],h=f.id;h.endsWith("/")||(h+="/");z.Utils.isImageProfile(f.getProfile())&&(b=h+"info.json")}return b}return c.id}(c):(a=a.getService(O.IXIF))?a.getInfoUri():null}function fa(a,c){var b=c.position;c=c.ratio;var d=a.props.style||{},e=d.maxHeight;d=u(d,["maxHeight"]);var f=e?"auto":e*c;return"fixed"===a.props.growthStyle?
(b=b?1/c*b.zoom:1,e=e&&b?e/(1/b):"auto",n(n({},d),{position:"absolute",top:a.props.y*c,left:a.props.x*c,height:a.props.height*c*b,width:a.props.width*c*b,maxHeight:e,transform:"scale("+1/b+")",transformOrigin:"top left"})):(a.props.growthStyle,n(n({},d),{position:"absolute",top:a.props.y*c,left:a.props.x*c,height:a.props.height*c,width:a.props.width*c,maxHeight:f}))}function ha(a){var c=a.getCanvasIds();return c.length===(a.__jsonld.items?a.__jsonld.items.length:c.length)?{canvases:c,regions:[]}:
a.__jsonld.items.reduce(function(a,c){var b="string"==typeof c?c:"Canvas"===c.type?c.id:"SpecificResource"===c.type?"string"==typeof c.source?c.source:c.source.id:null;return b&&(a.canvases.push(b),a.regions.push(function(a,b){var c=E(b);return c&&c!==b?c:a.selector&&(a=a.selector.value||a.selector,b=E("#"+a),b!==a)?b:null}(c,b))),a},{canvases:[],regions:[]})}var k="default"in l?l.default:l,P=function(a,c){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||
function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])})(a,c)},n=function(){return(n=Object.assign||function(a){for(var c,b=1,d=arguments.length;b<d;b++)for(var e in c=arguments[b])Object.prototype.hasOwnProperty.call(c,e)&&(a[e]=c[e]);return a}).apply(this,arguments)},v=r(C(),2),F=v[0],ia=v[1],ja=function(a){var c=a.url,b=a.locale,d=void 0===b?"en-GB":b,e=a.fetchOptions,f=a.jsonLd;a=a.children;var h=r(l.useState(),2);b=h[0];var m=h[1];h=r(l.useState(),2);var B=h[0],p=h[1];return l.useEffect(function(){f?
p(Q(f,{locale:d})):c&&fetch(c,e||{cache:"force-cache"}).then(function(a){return a.json()}).then(function(a){p(Q(a,{locale:d}))}).catch(function(){m("Something went wrong fetching this manifest.")})},[e,f,d,c]),b?k.createElement("div",null,b):B?k.createElement(ia,{value:B},a):k.createElement(k.Fragment,null)},ka=function(a){a=a.children;var c=F();return w(a,l.useMemo(function(){return{manifest:c}},[c]))},q,S=(q=function(a,c,b){return a(b={path:c,exports:{},require:function(a,b){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs");
}},b.exports),b.exports}(function(a,c){function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.__esModule=!0;var e=function(){function a(b){d(this,a);this.name=b}return a.prototype.modifier=function(a,b){return"[object Object]"===a.toString()?this.ms(a):b||void 0===b?this.name+" "+this.name+"--"+
a:this.name},a.prototype.m=function(a,b){this.modifier(a,b)},a.prototype.modifiers=function(a){var b=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],c=[this.name],d;for(d in a)a.hasOwnProperty(d)&&a[d]&&c.push(this.name+"--"+d);return b?c.join(" "):c},a.prototype.ms=function(a,b){this.modifiers(a,b)},a.prototype.toString=function(){return this.name},a}(),f=function(a){function c(){var e,f;d(this,c);for(var h=arguments.length,m=Array(h),k=0;k<h;k++)m[k]=arguments[k];return e=f=b(this,a.call.apply(a,
[this].concat(m))),f.e=f.element,b(f,e)}return function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(c,a),c.prototype.element=function(a){return new e(this.name+"__"+a)},c}(e),h={block:function(a){return new f(a)}};h.b=h.block;c.default=h;a.exports=
c.default}))&&q.__esModule&&Object.prototype.hasOwnProperty.call(q,"default")?q.default:q,R={prefix:"",cssClassMap:{}};v=r(C(R),2);var ba=v[0],la=v[1];v=function(a){return function(c){return function(b){var d=D(a);return k.createElement(c,n({},b,{bem:d}))}}};var U=function(a){var c=a.x,b=a.y,d=a.width,e=a.height,f=a.style,h=a.onClick,m=a.bemModifiers,g=a.annotation,p=a.annotationContent,n=D("annotation");a=m?m(g,a):null;m=l.useCallback(function(a){return h?h(g,{x:c||0,y:b||0,width:d,height:e},a):
null},[g,e,h,d,c,b]);return k.createElement("div",{className:a?n.modifiers(a):n,style:f,onClick:m},p?p(g,n):null)};q=r(C(),2);var x=q[0],ma=q[1],na=function(a){var c=a.startCanvas,b=void 0===c?0:c;c=a.sequence;var d=void 0===c?0:c,e=a.currentCanvas;a=a.children;c=r(l.useState(0),2);var f=c[0],h=c[1],m=F(),g=l.useCallback(function(a){var b=m.getSequenceByIndex(d);h("string"==typeof a?b.getCanvasIndexById(a):a)},[m,d]);l.useEffect(function(){0!==b&&g(b)},[g,b]);l.useEffect(function(){void 0!==e&&g(e)},
[e,g]);var p=l.useMemo(function(){return m.getSequenceByIndex(d)},[m,d]);c=l.useMemo(function(){return p.getCanvasByIndex(f)},[f,p]);var n=l.useCallback(function(){p.getTotalCanvases()>f+1&&h(f+1)},[f,p]),q=l.useCallback(function(){h(0===f?0:f-1)},[f]);return k.createElement(ma,{value:{sequence:p,canvas:c,currentCanvas:f,height:c.getHeight(),width:c.getWidth(),startCanvas:b,nextCanvas:n,prevCanvas:q}},a)},da=function(a){function c(b,c,e){b=a.call(this,b,c,e)||this;return b.getResources().length&&
(b.isLoaded=!0),b}return M(c,a),c.prototype.getResources=function(){var a=this;return(this.getProperty("resources")||this.getProperty("items")||[]).map(function(b){return new z.Annotation(b,a.options)})},c}(z.AnnotationList);q=r(C(),2);var oa=q[0],pa=q[1],qa=function(a){var c=a.annotationList;a=a.children;return k.createElement(pa,{value:l.useMemo(function(){return{annotationList:c}},[c])},a)},V=function(a){var c=a.children,b=u(a,["children"]),d=x().canvas;a=r(T(),1)[0];return d&&a?k.createElement(k.Fragment,
null,a.map(function(a,f){return k.createElement(qa,{annotationList:a},w(c,n({canvas:d,annotationList:a},b)))})):null},G,y,N,H,I,J,O,K,L,W=function(){function a(c,b,d,e,f,h,m){if(h&&h!==a.DIRECTION_AUTO&&h!==a.DIRECTION_LTR&&h!==a.DIRECTION_RTL)throw Error("textDirection must be ONE of [ltr, rtl, auto]");this.id=c;this.source=(c||"").split("#")[0];this.format=d;this.language=e;this.processingLanguage=f;this.textDirection=h;this.selector=a.parseTarget(c,b,m)}return a.fromJsonLD=function(c){return a.parse(c)},
a.fromArray=function(c){return c.map(function(b){return a.parse(b)})},a.fromTarget=function(c,b){var d=new a;return d.source=c,d.selector=b,d},a.parse=function(c,b){return void 0===b&&(b=1),c?"string"==typeof c?new a(c,b):c.id?new a(c.id,b,c.format,c.language,c.processingLanguage,c.textDirection):c.source?new a(c.source,b,c.format,c.language,c.processingLanguage,c.textDirection,c.selector):null:null},a.parseTarget=function(a,b,d){void 0===b&&(b=1);var c=a;if(d&&"FragmentSelector"===d.type&&(c=a+"#"+
d.value),c)return b=E(c,b),b!==c?b:a},a.prototype.toJSON=function(){return!this.selector||"string"==typeof this.selector||null===this.selector.x||isNaN(Math.floor(this.selector.x))||null===this.selector.y||isNaN(Math.floor(this.selector.y))?this.source:null===this.selector.width||void 0===this.selector.width||isNaN(this.selector.width)||null===this.selector.height||void 0===this.selector.height||isNaN(this.selector.height)?this.source+"#xywh="+Math.floor(this.selector.x)+","+Math.floor(this.selector.y)+
",0,0":this.source+"#xywh="+Math.floor(this.selector.x)+","+Math.floor(this.selector.y)+","+Math.floor(this.selector.width)+","+Math.floor(this.selector.height)},a.prototype.toString=function(){return this.id},a.DIRECTION_LTR="ltr",a.DIRECTION_RTL="rtl",a.DIRECTION_AUTO="auto",a}(),X=function(a){var c=a.children;a=u(a,["children"]);var b=oa().annotationList,d=l.useMemo(function(){return b.getResources().map(function(a){var c=(c=a.getOn()||a.getTarget())&&W.parse(c)||void 0;return{annotationList:b,
annotation:a,on:c}})},[b]);return b&&d?w(c,n(n({},a),{annotationList:b,annotations:d})):null},ra=function(a){a=a.children;var c=F(),b=x(),d=b.nextCanvas,e=b.prevCanvas;b=u(b,["nextCanvas","prevCanvas"]);var f=l.useCallback(function(a){switch(a.type){case "NEXT_CANVAS":d();break;case "PREV_CANVAS":e()}},[d,e]);return w(a,n({manifest:c,dispatch:f},b))},t=function(a){var c=a.children;a=u(a,["children"]);return k.createElement(na,n({},a),k.createElement(ra,null,c))};t.reducer=function(){throw Error("Use of this internal API is not supported.");
};t.NEXT_CANVAS="NEXT_CANVAS";t.PREV_CANVAS="PREV_CANVAS";t.nextCanvas=function(){return{type:t.NEXT_CANVAS}};t.prevCanvas=function(){return{type:t.PREV_CANVAS}};(function(a){a.BOOKMARKING="oa:bookmarking";a.CLASSIFYING="oa:classifying";a.COMMENTING="oa:commenting";a.DESCRIBING="oa:describing";a.EDITING="oa:editing";a.HIGHLIGHTING="oa:highlighting";a.IDENTIFYING="oa:identifying";a.LINKING="oa:linking";a.MODERATING="oa:moderating";a.PAINTING="sc:painting";a.QUESTIONING="oa:questioning";a.REPLYING=
"oa:replying";a.TAGGING="oa:tagging";a.TRANSCRIBING="oad:transcribing"})(G||(G={}));(function(a){a.AUTO_ADVANCE="auto-advance";a.CONTINUOUS="continuous";a.FACING_PAGES="facing-pages";a.HIDDEN="hidden";a.INDIVIDUALS="individuals";a.MULTI_PART="multi-part";a.NO_NAV="no-nav";a.NON_PAGED="non-paged";a.PAGED="paged";a.REPEAT="repeat";a.SEQUENCE="sequence";a.THUMBNAIL_NAV="thumbnail-nav";a.TOGETHER="together";a.UNORDERED="unordered"})(y||(y={}));(function(a){a.CANVAS="canvas";a.CHOICE="choice";a.CONTENT_AS_TEXT=
"contentastext";a.DATASET="dataset";a.DOCUMENT="document";a.IMAGE="image";a.MODEL="model";a.MOVING_IMAGE="movingimage";a.PDF="pdf";a.PHYSICAL_OBJECT="physicalobject";a.SOUND="sound";a.TEXT="text";a.TEXTUALBODY="textualbody";a.VIDEO="video"})(N||(N={}));(function(a){a.ANNOTATION="annotation";a.CANVAS="canvas";a.COLLECTION="collection";a.MANIFEST="manifest";a.RANGE="range";a.SEQUENCE="sequence"})(H||(H={}));(function(a){a.AUDIO_MP4="audio/mp4";a.CORTO="application/corto";a.DRACO="application/draco";
a.EPUB="application/epub+zip";a.GLB="model/gltf-binary";a.GLTF="model/gltf+json";a.JPG="image/jpeg";a.M3U8="application/vnd.apple.mpegurl";a.MP3="audio/mp3";a.MPEG_DASH="application/dash+xml";a.OBJ="text/plain";a.OPF="application/oebps-package+xml";a.PDF="application/pdf";a.PLY="application/ply";a.THREEJS="application/vnd.threejs+json";a.USDZ="model/vnd.usd+zip";a.VIDEO_MP4="video/mp4";a.WEBM="video/webm"})(I||(I={}));(function(a){a.DOC="application/msword";a.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document";
a.PDF="application/pdf"})(J||(J={}));(function(a){a.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0";a.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1";a.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2";a.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0";a.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1";
a.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2";a.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0";a.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1";a.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2";a.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0";
a.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1";a.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2";a.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json";a.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json";a.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json";a.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json";a.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json";
a.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json";a.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json";a.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json";a.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json";a.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json";a.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json";a.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json";a.AUTH_0_CLICK_THROUGH=
"http://iiif.io/api/auth/0/login/clickthrough";a.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login";a.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout";a.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted";a.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token";a.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough";a.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external";a.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk";a.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login";a.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout";
a.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe";a.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token";a.SEARCH_0="http://iiif.io/api/search/0/search";a.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete";a.SEARCH_1="http://iiif.io/api/search/1/search";a.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete";a.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile";a.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile";a.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile";
a.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile";a.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json";a.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"})(O||(O={}));(function(a){a.BOTTOM_TO_TOP="bottom-to-top";a.LEFT_TO_RIGHT="left-to-right";a.RIGHT_TO_LEFT="right-to-left";a.TOP_TO_BOTTOM="top-to-bottom"})(K||(K={}));(function(a){a.CONTINUOUS="continuous";a.INDIVIDUALS="individuals";a.NON_PAGED="non-paged";a.PAGED="paged";a.TOP="top"})(L||(L={}));var Y=
function(a){var c=a.ratio,b=void 0===c?1:c;c=(a.maxWidth,a.width);c=void 0===c?0:c;var d=a.height;d=void 0===d?0:d;var e=a.style,f=a.children,h=u(a,"ratio maxWidth width height style children".split(" ")),m=x().canvas;e=e||{};a=e.maxHeight;e=u(e,["maxHeight"]);return k.createElement("div",{style:n({position:"relative",height:d*b,width:c*b,pointerEvents:"none",maxHeight:a?a/b:void 0},e)},k.Children.map(f,function(a){if(a){var c=a&&a.type&&"div"===a.type?{}:n({canvas:m},h);return k.cloneElement(a,n({style:fa(a,
{position:h.position,ratio:b})},c))}return k.createElement(k.Fragment,null)}))};G=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;return b.state={currentIndex:0,currentRangeObject:void 0,currentRange:void 0,canvasList:[],regionList:[]},b.nextRange=function(){var a=b.state,c=a.currentIndex;c>=a.canvasList.length-1||b.goToRange(c+1)},b.previousRange=function(){var a=b.state.currentIndex;0!==a&&b.goToRange(a-1)},b.goToRange=function(a){var c=b.state.canvasList;b.props.controlled||
b.setState({currentIndex:a});b.props.onNavigate&&b.props.onNavigate(a,c[a])},b.getCanvasAtIndex=function(a){var c=b.props.manifest,d=b.state.canvasList;try{return c&&0!==d.length?c.getSequenceByIndex(0).getCanvasById(d[a]):null}catch(h){return null}},b.getNextRange=function(a){return function(){if(!(a>=b.state.canvasList.length-1))return b.getCanvasAtIndex(a+1)}},b.getPreviousRange=function(a){return function(){if(0!==a)return b.getCanvasAtIndex(a-1)}},b}return M(c,a),c.prototype.componentWillMount=
function(){var a=this.getMatchingRange(this.props);if(a)return this.setState({currentRangeObject:a.range,currentRange:a.id,canvasList:a.canvasList,regionList:a.regionList||[]})},c.prototype.getMatchingRange=function(a){var b=a.manifest,c=a.rangeId,f=a.rangeViewingHint;if(a=(b?b.getAllRanges():[]).reduce(function(a,b){if(a)return a;if(c&&b.id===c)return b;a=b.getViewingHint();return f&&a&&a.toString()===f?b:(a=b.getBehavior())&&"sequence"===a.toString()?b:null},null))return b=ha(a),{range:a,id:a.id,
canvasList:b.canvases,regionList:b.regions};if(!b)throw Error();return{range:void 0,id:b.id,regionList:[],canvasList:b.getSequenceByIndex(0).getCanvases().map(function(a){return a.id})}},c.prototype.componentWillReceiveProps=function(a,c){if(a.currentIndex!==this.props.currentIndex&&a.currentIndex!==this.state.currentIndex&&this.setState({currentIndex:a.currentIndex||0}),a.rangeId!==this.props.rangeId||a.rangeViewingHint!==this.props.rangeViewingHint||a.manifest!==this.props.manifest)a=this.getMatchingRange(this.props),
this.setState({currentRangeObject:a.range,currentRange:a.id,canvasList:a.canvasList,regionList:a.regionList||[]})},c.prototype.render=function(){var a=this.props,c=a.children;a=u(a,["children"]);var e=this.state,f=e.currentIndex,h=e.currentRange,m=e.canvasList,g=e.regionList;e=e.currentRangeObject;if(!a.manifest)return null;var l=0!==m.length?a.manifest.getSequenceByIndex(0).getCanvasById(m[f]):null;g=0!==g.length?g[f]:null;return k.createElement(t,{currentCanvas:l?l.id:void 0},w(c,n(n({},a),{nextRange:this.nextRange,
previousRange:this.previousRange,getNextRange:this.getNextRange(f),getPreviousRange:this.getPreviousRange(f),goToRange:this.goToRange,currentIndex:f,rangeId:h,range:e,canvasList:m,region:g,currentCanvasId:l?l.id:null,canvas:l})))},c.defaultProps={fallbackToTop:!0,fallbackToSequence:!0,controlled:!1},c}(l.Component);var Z=function(a){var c=a.annotations;c=void 0===c?[]:c;var b=a.onClickAnnotation,d=a.annotationStyle,e=a.growthStyle,f=a.bemModifiers,h=a.annotationContent;a=u(a,"annotations onClickAnnotation annotationStyle growthStyle bemModifiers annotationContent".split(" "));
return k.createElement(Y,n({},a),c.map(function(a,c){var g=a.annotation;a=a.on;return"string"==typeof a.selector?null:k.createElement(U,{key:c,x:a.selector&&a.selector.x?a.selector.x:void 0,y:a.selector&&a.selector.y?a.selector.y:void 0,width:a.selector&&a.selector.width?a.selector.width:void 0,height:a.selector&&a.selector.height?a.selector.height:void 0,annotation:g,style:d,onClick:b,growthStyle:e,bemModifiers:f,annotationContent:h})}))};y=function(a){function c(){return null!==a&&a.apply(this,
arguments)||this}return M(c,a),c.prototype.render=function(){var a=this.props,c=a.annotation,e=a.onClose,f=a.closeText,h=a.bem;a=c.getResource();var g=c.getBody();return g.length?k.createElement("div",{className:h},g.map(function(a,b){return k.createElement("div",{key:b},a.__jsonld.label?k.createElement("h1",{className:h.element("label")},a.__jsonld.label):null,k.createElement("div",{className:h.element("value"),key:b,dangerouslySetInnerHTML:{__html:a.__jsonld.value}}),e?k.createElement("button",
{className:h.element("close"),onClick:e},f):null)})):a&&a.getProperty("within")?(c=a.getProperty("within"),k.createElement("div",{className:h},k.createElement("h1",{className:h.element("label")},c.label),k.createElement("p",{className:h.element("description")},c.description),e?k.createElement("button",{className:h.element("close"),onClick:e},f):null)):k.createElement("div",{className:h},k.createElement("h1",{className:h.element("label")},c.getLabel()),k.createElement("p",{className:h.element("description")},
c.getProperty("description")),e?k.createElement("button",{className:h.element("close"),onClick:e},f):null)},c.defaultProps={closeText:"close"},c}(l.Component);y=v("annotation-detail")(y);H=require("@canvas-panel/core/es/components/EditableAnnotation/EditableAnnotation").default;I=require("@canvas-panel/core/es/components/Fullscreen/Fullscreen").default;J=require("@canvas-panel/core/es/components/ObservableElement/ObservableElement").default;K=require("@canvas-panel/core/es/manifesto/LocaleString/LocaleString").default;
L=require("@canvas-panel/core/es/viewers/FullPageViewport/FullPageViewport").default;q=require("@canvas-panel/core/es/viewers/OpenSeadragonViewer/OpenSeadragonViewer").default;var sa=require("@canvas-panel/core/es/viewers/OpenSeadragonViewport/OpenSeadragonViewport").default,ta=require("@canvas-panel/core/es/viewers/SizedViewport/SizedViewport").default,ua=require("@canvas-panel/core/es/viewers/StaticImageViewport/StaticImageViewport").default,va=require("@canvas-panel/core/es/viewers/Viewport/Viewport").default,
wa=require("@canvas-panel/core/es/utility/htmlElementObserver").default,xa=require("@canvas-panel/core/es/utility/Responsive").default;g.Annotation=U;g.AnnotationCanvasRepresentation=function(a){var c=a.annotationStyle,b=a.onClickAnnotation,d=a.growthStyle,e=a.bemModifiers;a=u(a,["annotationStyle","onClickAnnotation","growthStyle","bemModifiers"]);return k.createElement(V,n({},a),k.createElement(X,null,k.createElement(Z,{onClickAnnotation:b,annotationStyle:c,growthStyle:d,bemModifiers:e})))};g.AnnotationDetail=
y;g.AnnotationListProvider=V;g.AnnotationProvider=X;g.AnnotationRepresentation=Z;g.AnnotationSelector=W;g.Bem=function(a){var c=a.children,b=a.prefix,d=void 0===b?"":b;a=a.cssClassMap;var e=void 0===a?{}:a;return k.createElement(la,{value:l.useMemo(function(){return{prefix:d,cssClassMap:e}},[d,e])},c)};g.CanvasNavigation=function(){var a=x(),c=a.nextCanvas;a=a.prevCanvas;var b=D("canvas-navigation");return k.createElement("div",{className:b},k.createElement("button",{className:b.element("previous"),
onClick:c},"Prev"),k.createElement("button",{className:b.element("next"),onClick:a},"Next"))};g.CanvasProvider=t;g.CanvasRepresentation=Y;g.EditableAnnotation=H;g.FullPageViewport=L;g.Fullscreen=I;g.LocaleString=K;g.Manifest=function(a){var c=a.children;a=u(a,["children"]);return k.createElement(ja,n({},a),k.createElement(ka,null,c))};g.ObservableElement=J;g.OpenSeadragonViewer=q;g.OpenSeadragonViewport=sa;g.RangeNavigationProvider=G;g.Responsive=xa;g.SingleTileSource=function(a){var c=a.preLoad,
b=a.fallbackWidth,d=a.children,e=u(a,["preLoad","fallbackWidth","children"]),f=x().canvas,h=r(l.useState(),2),g=h[0],q=h[1];h=r(l.useState(),2);var p=h[0],t=h[1],v=l.useRef();if(l.useEffect(function(){q(ea(f));t(void 0)},[f]),l.useEffect(function(){if(g&&!p)return g.endsWith("/info.json")?(v.current=g,void fetch(g).then(function(a){return a.json()}).then(function(a){v.current===g&&t([a])})):void t([{type:"image",url:g}])},[g,p]),!p||0===p.length)return k.createElement(k.Fragment,null);if(d)return w(d,
n({canvas:f,imageUri:g,tileSources:p},e));if(c)return c(a);a=(a=p?p[0]:null)&&"image"===a.type?a.url:f.getCanonicalImageUri(b);return k.createElement("div",null,k.createElement("img",{width:b,src:a}))};g.SizedViewport=ta;g.StaticImageViewport=ua;g.Viewport=va;g.functionOrMapChildren=w;g.htmlElementObserver=wa;g.parseSelectorTarget=E;g.useAnnotationLists=T;g.useBemClassName=D;g.useCanvas=x;g.useManifest=F;g.withBemClass=v;Object.defineProperty(g,"__esModule",{value:!0})})
//# sourceMappingURL=index.umd.js.map
